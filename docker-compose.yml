services:
  mongo:
    image: mongo:7
    platform: linux/amd64
    volumes:
      - mongo-data:/data/db

  api:
    build:
      context: .
      dockerfile: packages/api/Dockerfile
    image: registry.digitalocean.com/sequenced-registry/sequenced-api:latest
    platform: linux/amd64
    environment:
      APP_URL: https://sequenced.ottegi.com
      SESSION_SECRET: change-me
      DATABASE_URL: mongodb://mongo:27017/sequenced
      PORT: 8080
    depends_on:
      - mongo
    restart: unless-stopped
    ports:
      - "8080:8080"   # optional if you reverse-proxy internally

  frontend:
    build:
      context: .
      dockerfile: packages/app/Dockerfile
      args:
        # Build-time API endpoint baked into the Vite bundle.
        VITE_API_URL: https://api.sequenced.ottegi.com
    image: registry.digitalocean.com/sequenced-registry/sequenced-frontend:latest
    platform: linux/amd64
    environment:
      API_URL: https://api.sequenced.ottegi.com
      APP_URL: https://sequenced.ottegi.com
    depends_on:
      - api
    restart: unless-stopped
    ports:
      - "4173:80"     # optional if you reverse-proxy internally

volumes:
  mongo-data:
