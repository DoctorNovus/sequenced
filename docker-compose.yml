services:
  api:
    build:
      context: .
      dockerfile: packages/api/Dockerfile
    image: sequenced-api:local
    platform: linux/amd64
    environment:
      APP_URL: ${APP_URL}
      SESSION_SECRET: ${SESSION_SECRET}
      DATABASE_URL: ${DATABASE_URL}
      PORT: ${PORT}
    depends_on:
      - mongo
    restart: unless-stopped
    ports:
      - "127.0.0.1:8080:8080"

  frontend:
    build:
      context: .
      dockerfile: packages/app/Dockerfile
    image: sequenced-frontend:local
    platform: linux/amd64
    depends_on:
      - api
    restart: unless-stopped
    ports:
      - "127.0.0.1:4173:80"

  mongo:
    image: mongo:7
    platform: linux/amd64
    command: ["mongod", "--auth"]
    volumes:
      - mongo-data:/data/db
    restart: unless-stopped
    ports:
      - "127.0.0.1:27017:27017"

volumes:
  mongo-data:
